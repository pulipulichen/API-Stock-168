name: Build and Deploy
on: 
  push:
  schedule:
    - cron:  "0 */3 * * *"
permissions:
  contents: write
jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # Recommended if you intend to make multiple deployments in quick succession.
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v3

      # - uses: actions/setup-node@v3
      #   with:
      #     node-version: '14'
      # - run: npm help

      # - name: Docker test
      #   run: docker run hello-world

      # - name: Install and Build 🔧 # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      #   run: |
      #     mkdir -p build
      #     node index.js
      #     echo `date` >> build/okk.txt
      #     sh goodbye.sh

      # - name: Test
      #   run: |
      #     cat build/okk.txt
      #     cat build/ccc.txt
      #     cat build/nodejs.txt

      # - name: page-build
      #   run: |
      #     mkdir -p build
      #     echo `date` >> build/ok.txt

      - name: Restore cached Primes
        id: cache-primes-restore
        uses: actions/cache/restore@v3
        with:
          path: |
            build
          key: ${{ runner.os }}-primes

      - name: page-build
        run: |
          mkdir -p build
          echo `date` >> build/ok.txt
          cat build/ok.txt

      - name: Save Primes
        id: cache-primes-save
        uses: actions/cache/save@v3
        with:
          path: |
            build
          key: ${{ steps.cache-primes-restore.outputs.cache-primary-key }}

      # - name: temp
      #   run: |
      #     mkdir -p ${{ runner.temp }}/build_logs
      #     echo `date` >> ${{ runner.temp }}/build_logs/tmp.txt
      #     cat ${{ runner.temp }}/build_logs/tmp.txt
      #     mkdir -p build
      #     cp ${{ runner.temp }}/build_logs/tmp.txt build

      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: build # The folder the action should deploy.